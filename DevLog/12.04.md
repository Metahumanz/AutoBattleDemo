# éœ€è¦å®šä¹‰çš„c++ç±»

**â€œæ¥å£å…ˆè¡Œâ€**

æ ¹æ®éœ€æ±‚ï¼ˆæ’å…µå¸ƒé˜µ -> æˆ˜æ–— -> ç»“ç®— -> ä¸‹ä¸€å…³ï¼‰ï¼Œé‡æ–°æ¢³ç†ã€‚


---

### ğŸ›ï¸ å…¬å…±ç±»å‹å®šä¹‰ (Common Types)
å»ºè®®æ–°å»ºä¸€ä¸ªå¤´æ–‡ä»¶ `RTSCoreTypes.h`ï¼Œå­˜æ”¾å¤§å®¶é€šç”¨çš„æšä¸¾å’Œç»“æ„ä½“ï¼Œé¿å…å¾ªç¯å¼•ç”¨ã€‚

```cpp
// RTSCoreTypes.h
#pragma once
#include "CoreMinimal.h"
#include "RTSCoreTypes.generated.h"

// æ¸¸æˆé˜¶æ®µçŠ¶æ€
UENUM(BlueprintType)
enum class EGameState : uint8
{
    Preparation, // å¤‡æˆ˜é˜¶æ®µï¼šç©å®¶ä¹°å…µã€æ‘†é˜µ
    Battle,      // æˆ˜æ–—é˜¶æ®µï¼šè‡ªåŠ¨å¯»è·¯ã€æ”»å‡»
    Victory,     // ç»“ç®—ï¼šèƒœåˆ©
    Defeat       // ç»“ç®—ï¼šå¤±è´¥
};

// é˜Ÿä¼é˜µè¥
UENUM(BlueprintType)
enum class ETeam : uint8
{
    Player,
    Enemy
};

// å…µç§ç±»å‹ï¼ˆç”¨äºå•†åº—è´­ä¹°ï¼‰
UENUM(BlueprintType)
enum class EUnitType : uint8
{
    Soldier, // è¿‘æˆ˜
    Archer,  // è¿œç¨‹
    Tank     // è‚‰ç›¾
};
```

---

### ğŸ—ºï¸ æˆå‘˜ Aï¼šç½‘æ ¼ä¸å¯»è·¯ç³»ç»Ÿ (Grid & Pathfinder)

ä½ çš„ä»»åŠ¡æ˜¯æä¾›ä¸Šå¸è§†è§’çš„åœ°å›¾æ•°æ®ã€‚

#### 1. `GridManager.h` (æ ¸å¿ƒåœ°å›¾ç®¡ç†å™¨)
```cpp
#pragma once
#include "CoreMinimal.h"
#include "GameFramework/Actor.h"
#include "RTSCoreTypes.h"
#include "GridManager.generated.h"

// å®šä¹‰æ ¼å­çš„ç»“æ„ä½“
USTRUCT(BlueprintType)
struct FGridNode
{
    GENERATED_BODY()
    
    // æ ¼å­åæ ‡
    int32 X;
    int32 Y;
    
    // ä¸–ç•Œåæ ‡ä¸­å¿ƒç‚¹
    FVector WorldLocation;
    
    // æ˜¯å¦è¢«é˜»æŒ¡ï¼ˆæœ‰å¢™æˆ–é˜²å¾¡å¡”ï¼‰
    bool bIsBlocked;

    // å¯»è·¯æ¶ˆè€— (å¯ä»¥é¢„ç•™ï¼Œæ¯”å¦‚æ²¼æ³½åœ°èµ°å¾—æ…¢)
    float Cost; 
};

UCLASS()
class AUTOBATTLEDEMO_API AGridManager : public AActor
{
    GENERATED_BODY()
    
public:    
    AGridManager();

    // --- ä¾›æˆå‘˜ C è°ƒç”¨ï¼šåˆå§‹åŒ–åœ°å›¾ ---
    // ç”Ÿæˆå¯è§†åŒ–æ ¼å­ï¼ˆDebugçº¿æˆ–æ¨¡å‹ï¼‰ï¼Œåˆå§‹åŒ– GridArray
    UFUNCTION(BlueprintCallable, Category = "Grid")
    void GenerateGrid(int32 Width, int32 Height, float CellSize);

    // --- ä¾›æˆå‘˜ C è°ƒç”¨ï¼šäº¤äº’è½¬æ¢ ---
    // é¼ æ ‡ç‚¹çš„ä¸–ç•Œåæ ‡ -> æ ¼å­åæ ‡ (ç”¨äºé€ å…µæ—¶å¸é™„ç½‘æ ¼)
    UFUNCTION(BlueprintCallable, Category = "Grid")
    bool WorldToGrid(FVector WorldPos, int32& OutX, int32& OutY);

    // æ ¼å­åæ ‡ -> ä¸–ç•Œåæ ‡ (ç”¨äºæŠŠå…µæ‘†åœ¨æ ¼å­æ­£ä¸­é—´)
    UFUNCTION(BlueprintCallable, Category = "Grid")
    FVector GridToWorld(int32 X, int32 Y);

    // --- ä¾›æˆå‘˜ C è°ƒç”¨ï¼šé˜»æŒ¡è®¾ç½® ---
    // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ”¾ç½® (ä¸èƒ½é‡å ï¼Œä¹Ÿä¸èƒ½æ”¾åœ¨éšœç¢ç‰©ä¸Š)
    UFUNCTION(BlueprintCallable, Category = "Grid")
    bool IsTileWalkable(int32 X, int32 Y);

    // æ”¾ç½®å»ºç­‘åè°ƒç”¨ï¼Œé”å®šè¯¥æ ¼å­
    UFUNCTION(BlueprintCallable, Category = "Grid")
    void SetTileBlocked(int32 X, int32 Y, bool bBlocked);

    // --- ä¾›æˆå‘˜ B è°ƒç”¨ï¼šæ ¸å¿ƒå¯»è·¯ ---
    // è¾“å…¥ï¼šèµ·ç‚¹ä¸–ç•Œåæ ‡ï¼Œç»ˆç‚¹ä¸–ç•Œåæ ‡
    // è¾“å‡ºï¼šè·¯å¾„ç‚¹åˆ—è¡¨ (World Locations)
    // é‡ç‚¹ï¼šå¦‚æœæ‰¾ä¸åˆ°è·¯å¾„ï¼Œè¿”å›ç©ºæ•°ç»„
    UFUNCTION(BlueprintCallable, Category = "Pathfinding")
    TArray<FVector> FindPath(FVector StartPos, FVector EndPos);

public:
    // äºŒç»´æ•°ç»„æ‰å¹³åŒ–å­˜å‚¨ï¼Œæˆ–è€…ä½¿ç”¨ TArray<FGridNode>
    // å»ºè®®ä½¿ç”¨ TMap<FIntPoint, FGridNode> æˆ–è€…ä¸€ç»´æ•°ç»„ Index = Y * Width + X
    TArray<FGridNode> GridNodes;

    UPROPERTY(EditAnywhere, Category = "Grid Config")
    int32 GridWidthCount;

    UPROPERTY(EditAnywhere, Category = "Grid Config")
    int32 GridHeightCount;

    UPROPERTY(EditAnywhere, Category = "Grid Config")
    float TileSize;
};
```

---

### âš”ï¸ æˆå‘˜ Bï¼šæˆ˜æ–—å•ä½ (Unit & Combat)

ä½ çš„ä»»åŠ¡æ˜¯å®ç°â€œå¬è¯â€çš„å£«å…µå’Œâ€œè¢«æ‰“â€çš„å®ä½“ã€‚

#### 1. `BaseGameEntity.h` (æ‰€æœ‰ç‰©ä½“çš„åŸºç±»)
é˜²å¾¡å¡”å’Œå£«å…µéƒ½ç»§æ‰¿å®ƒï¼Œå› ä¸ºéƒ½æœ‰è¡€æ¡å’Œé˜µè¥ã€‚
```cpp
#pragma once
#include "CoreMinimal.h"
#include "GameFramework/Pawn.h" // ç”¨ Pawn æ¯” Actor å¥½ï¼Œæ–¹ä¾¿æ‰©å±•ç§»åŠ¨
#include "RTSCoreTypes.h"
#include "BaseGameEntity.generated.h"

UCLASS()
class AUTOBATTLEDEMO_API ABaseGameEntity : public APawn
{
    GENERATED_BODY()

public:
    ABaseGameEntity();

    // --- å±æ€§ ---
    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Stats")
    float MaxHealth;

    UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "Stats")
    float CurrentHealth;

    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Stats")
    ETeam TeamID; // åŒºåˆ†ç©å®¶è¿˜æ˜¯æ•Œäºº

    // --- æ¥å£ ---
    // å—ä¼¤é€»è¾‘
    virtual float TakeDamage(float DamageAmount, struct FDamageEvent const& DamageEvent, class AController* EventInstigator, AActor* DamageCauser) override;

    // æ­»äº¡é€»è¾‘ï¼ˆä¾› GameMode ç›‘å¬ï¼‰
    virtual void Die();

    // ç”šè‡³å¯ä»¥åŠ ä¸€ä¸ªå§”æ‰˜ï¼Œå½“æ­»äº¡æ—¶é€šçŸ¥ GameMode æ£€æŸ¥èƒœåˆ©æ¡ä»¶
    // FOnEntityDiedSignature OnDeath; 
};
```

#### 2. `BaseUnit.h` (å¯ç§»åŠ¨çš„å£«å…µ)
**æ³¨æ„ï¼š** å› ä¸ºæ²¡æœ‰ NavMeshï¼Œä½ å¿…é¡»åœ¨ `Tick` é‡Œè‡ªå·±å®ç°ç§»åŠ¨ã€‚
```cpp
#pragma once
#include "CoreMinimal.h"
#include "BaseGameEntity.h"
#include "BaseUnit.generated.h"

// å£«å…µçŠ¶æ€æœº
UENUM()
enum class EUnitState : uint8
{
    Idle,       // ç«™æ¡©ï¼ˆå¤‡æˆ˜é˜¶æ®µæˆ–æ— ç›®æ ‡ï¼‰
    Moving,     // æ­£åœ¨æ²¿è·¯å¾„ç§»åŠ¨
    Attacking   // æ”»å‡»ä¸­
};

UCLASS()
class AUTOBATTLEDEMO_API ABaseUnit : public ABaseGameEntity
{
    GENERATED_BODY()
public:
    ABaseUnit();
    virtual void Tick(float DeltaTime) override;

    // --- ä¾› GameMode è°ƒç”¨ ---
    // æ¸¸æˆå¼€å§‹ï¼Œæ¿€æ´»æˆ˜æ–— AI
    UFUNCTION(BlueprintCallable)
    void SetUnitActive(bool bActive);

    // --- å±æ€§ ---
    UPROPERTY(EditAnywhere, Category = "Combat")
    float AttackRange;

    UPROPERTY(EditAnywhere, Category = "Combat")
    float Damage;

    UPROPERTY(EditAnywhere, Category = "Movement")
    float MoveSpeed;

    UPROPERTY(EditAnywhere, Category = "Combat")
    float AttackInterval;

protected:
    // --- æ ¸å¿ƒé€»è¾‘ ---
    // 1. å¯»æ‰¾æœ€è¿‘çš„æ•Œäºº (éå†æ‰€æœ‰ ABaseGameEntity)
    AActor* FindClosestEnemy();

    // 2. è¯·æ±‚è·¯å¾„ (è°ƒç”¨ Member A çš„ GridManager)
    void RequestPathToTarget();

    // 3. æ²¿è·¯å¾„ç§»åŠ¨ (Tick ä¸­æ‰§è¡Œ)
    void MoveAlongPath(float DeltaTime);

    // 4. æ‰§è¡Œæ”»å‡»
    void PerformAttack();

private:
    EUnitState CurrentState;
    
    // ç¼“å­˜å½“å‰çš„è·¯å¾„ç‚¹åˆ—è¡¨
    TArray<FVector> PathPoints;
    int32 CurrentPathIndex;

    // å½“å‰é”å®šçš„ç›®æ ‡
    UPROPERTY()
    AActor* CurrentTarget;

    // æ”»å‡»è®¡æ—¶å™¨
    float LastAttackTime;

    // å¼•ç”¨ GridManager (BeginPlay è·å–)
    class AGridManager* GridManagerRef;
};
```

---

### ğŸ—ï¸ æˆå‘˜ Cï¼šæ¸¸æˆæ§åˆ¶ä¸æµç¨‹ (Game Flow)

ä½ æ˜¯æŠŠ A å’Œ B ä¸²èµ·æ¥çš„äººã€‚

#### 1. `RTSGameInstance.h` (è·¨å…³å¡æ•°æ®)
å› ä¸ºè¦â€œä¸‹ä¸€å¾ªç¯â€ï¼Œé‡‘å¸å¿…é¡»å­˜åœ¨ GameInstance é‡Œï¼Œä¸ç„¶åˆ‡å…³å¡å°±æ²¡äº†ã€‚
```cpp
#pragma once
#include "CoreMinimal.h"
#include "Engine/GameInstance.h"
#include "RTSGameInstance.generated.h"

UCLASS()
class AUTOBATTLEDEMO_API URTSGameInstance : public UGameInstance
{
    GENERATED_BODY()
public:
    // ç©å®¶æŒæœ‰çš„é‡‘å¸ (è·¨å…³å¡ä¿å­˜)
    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Player Data")
    int32 PlayerGold;

    // å½“å‰å…³å¡ç´¢å¼• (0, 1, 2)
    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Player Data")
    int32 CurrentLevelIndex;
};
```

#### 2. `RTSGameMode.h` (å…³å¡è§„åˆ™è£åˆ¤)
```cpp
#pragma once
#include "CoreMinimal.h"
#include "GameFramework/GameModeBase.h"
#include "RTSCoreTypes.h"
#include "RTSGameMode.generated.h"

UCLASS()
class AUTOBATTLEDEMO_API ARTSGameMode : public AGameModeBase
{
    GENERATED_BODY()
public:
    ARTSGameMode();
    virtual void BeginPlay() override;

    // --- æµç¨‹æ§åˆ¶ API (ä¾› UI è°ƒç”¨) ---
    
    // 1. å°è¯•è´­ä¹°å¹¶æ”¾ç½®å•ä½
    // è¿”å› true è¡¨ç¤ºè´­ä¹°æˆåŠŸï¼Œæ‰£é’±ï¼›è¿”å› false è¡¨ç¤ºé’±ä¸å¤Ÿ
    UFUNCTION(BlueprintCallable, Category = "GameFlow")
    bool TryBuyUnit(EUnitType Type, int32 Cost);

    // 2. ç©å®¶ç‚¹å‡»â€œå¼€å§‹æˆ˜æ–—â€
    UFUNCTION(BlueprintCallable, Category = "GameFlow")
    void StartBattlePhase();

    // 3. é‡æ–°å¼€å§‹æœ¬å…³
    UFUNCTION(BlueprintCallable, Category = "GameFlow")
    void RestartLevel();

    // --- è£åˆ¤é€»è¾‘ ---
    // å•ä½æ­»äº¡æ—¶è°ƒç”¨æ­¤å‡½æ•°
    void OnActorKilled(AActor* Victim, AActor* Killer);

    // æ£€æŸ¥æ˜¯å¦èƒœåˆ© (æ¯å½“æœ‰å•ä½æ­»äº¡æ—¶æ£€æŸ¥)
    void CheckWinCondition();

protected:
    // å½“å‰æ¸¸æˆçŠ¶æ€
    UPROPERTY(BlueprintReadOnly, Category = "GameFlow")
    EGameState CurrentState;

    // å¼•ç”¨ï¼šåœ°å›¾ä¸Šçš„ GridManager
    UPROPERTY()
    class AGridManager* GridManager;

    // é…ç½®ï¼šä¸åŒå…µç§çš„è“å›¾ç±» (ç”¨äº Spawn)
    UPROPERTY(EditDefaultsOnly, Category = "Classes")
    TSubclassOf<class ABaseUnit> SoldierClass;
    
    UPROPERTY(EditDefaultsOnly, Category = "Classes")
    TSubclassOf<class ABaseUnit> ArcherClass;
};
```

#### 3. `RTSPlayerController.h` (æ“ä½œæ‰‹)
è´Ÿè´£å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼ŒæŠŠå…µâ€œç²˜â€åœ¨é¼ æ ‡ä¸Šï¼Œç›´åˆ°ç‚¹ä¸‹ç½‘æ ¼ã€‚
```cpp
#pragma once
#include "CoreMinimal.h"
#include "GameFramework/PlayerController.h"
#include "RTSCoreTypes.h" // å¼•ç”¨æšä¸¾
#include "RTSPlayerController.generated.h"

UCLASS()
class AUTOBATTLEDEMO_API ARTSPlayerController : public APlayerController
{
    GENERATED_BODY()
public:
    ARTSPlayerController();
    virtual void Tick(float DeltaTime) override;

    // --- äº¤äº’é€»è¾‘ ---
    
    // ç©å®¶ç‚¹å‡»äº†UIä¸Šçš„â€œè´­ä¹°æ­¥å…µâ€
    UFUNCTION(BlueprintCallable)
    void OnSelectUnitToPlace(EUnitType UnitType);

    // é¼ æ ‡ç‚¹å‡»å·¦é”® (åœ¨ Blueprint ä¸­ç»‘å®š Input Action: LeftClick)
    UFUNCTION(BlueprintCallable)
    void HandleLeftClick();

private:
    // å½“å‰æ­£åœ¨â€œæ‹–æ‹½/æ‚¬åœâ€å‡†å¤‡æ”¾ç½®çš„å•ä½ç±»å‹
    EUnitType PendingUnitType;
    bool bIsPlacingUnit;

    // ä¸€ä¸ªä¸´æ—¶çš„ Actorï¼Œè·Ÿç€é¼ æ ‡è·‘ï¼Œæ˜¾ç¤ºé¢„è§ˆæ•ˆæœ
    UPROPERTY()
    AActor* PlacementPreviewActor;
};
```

---

### ğŸš€ ç«‹å³æ‰§è¡Œæ­¥éª¤

1.  **ç»„é•¿ (æˆ–ä»»ä½•ä¸€äºº)**ï¼šæ‰“å¼€ VSï¼Œåˆ›å»ºä¸Šè¿°æ‰€æœ‰ `.h` æ–‡ä»¶ã€‚
2.  **å†…å®¹**ï¼šå°†ä»£ç å¤åˆ¶è¿›å»ã€‚
3.  **æäº¤**ï¼š`Git add .` -> `Git commit` -> `Git push`ã€‚
4.  **åˆ†å·¥**ï¼š
    *   **A** å»å†™ `GridManager.cpp`ï¼Œé‡ç‚¹å®ç° `FindPath`ã€‚
    *   **B** å»å†™ `BaseUnit.cpp`ï¼Œé‡ç‚¹å®ç° `Tick` é‡Œçš„ `MoveAlongPath`ã€‚
    *   **C** å»å†™ `RTSGameMode.cpp` å’Œ UI è“å›¾ï¼Œå®ç°é‡‘å¸æ‰£é™¤å’Œå…³å¡åˆ‡æ¢ã€‚

è¿™å¥—æ¥å£å·²ç»å¸®ä½ ä»¬è§£å†³äº†â€œè°è°ƒè°â€çš„é—®é¢˜ï¼š
*   B é‡Œçš„å•ä½åªéœ€è¦è°ƒ `GridManager->FindPath`ã€‚
*   C é‡Œçš„ Controller åªéœ€è¦è°ƒ `GridManager->WorldToGrid`ã€‚
*   å¤§å®¶äº’ä¸å¹²æ‰°ï¼Œå®Œç¾ï¼


ä½ è¯´å¾—å¾ˆå¯¹ï¼è¿™æ˜¯ UE4/UE5 çš„æœºåˆ¶ï¼š**ä¸€å®šè¦åœ¨ç¼–è¾‘å™¨å†…éƒ¨ç‚¹å‡»â€œæ–°å»º C++ ç±»â€**ã€‚

å› ä¸º UE4 åœ¨åˆ›å»ºç±»æ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªä¼´éšçš„ `.generated.h` æ–‡ä»¶ï¼ˆåå°„ç³»ç»Ÿï¼‰ï¼Œå¹¶åœ¨ `.uproject` å’Œæ„å»ºç³»ç»Ÿä¸­æ³¨å†Œã€‚å¦‚æœä½ åœ¨å¤–é¢æ‰‹åŠ¨å»ºæ–‡ä»¶ï¼Œå¼•æ“æ ¹æœ¬ä¸çŸ¥é“å®ƒçš„å­˜åœ¨ï¼Œä¹Ÿå°±æ— æ³•ç¼–è¯‘ã€‚

ä¸‹é¢æ˜¯ä½ éœ€è¦åœ¨ç¼–è¾‘å™¨ä¸­é€‰æ‹©çš„**çˆ¶ç±» (Parent Class)** ä»¥åŠ**ç±»å (Name)** çš„å¯¹åº”åˆ—è¡¨ï¼š

---

### 1. `RTSCoreTypes.h` (ç‰¹æ®Šæƒ…å†µ)
è¿™æ˜¯ä¸€ä¸ªå­˜æ”¾æšä¸¾å’Œç»“æ„ä½“çš„å¤´æ–‡ä»¶ï¼Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»ã€‚

*   **çˆ¶ç±»é€‰æ‹©**ï¼š**None** (ç©ºç±»)
    *   *æ³¨ï¼šåœ¨æ–°å»ºç±»çª—å£çš„å³ä¸Šè§’å‹¾é€‰ "Show All Classes"ï¼ˆæ˜¾ç¤ºæ‰€æœ‰ç±»ï¼‰ï¼Œç„¶åæœç´¢ "None" æˆ–è€…æ‰¾ "Empty C++ Class" (ç©º C++ ç±»)ã€‚*
*   **ç±»åå¡«å†™**ï¼š`RTSCoreTypes`
*   **åˆ›å»ºåæ“ä½œ**ï¼šUE ä¼šç”Ÿæˆ `.h` å’Œ `.cpp`ã€‚ä½ æŠŠ `.h` çš„å†…å®¹æ›¿æ¢æˆæˆ‘ç»™ä½ çš„ä»£ç ã€‚`.cpp` æ–‡ä»¶é‡Œé¢ç•™ç©ºæˆ–è€…ä¿æŒé»˜è®¤å³å¯ï¼Œä¸ç”¨ç®¡å®ƒã€‚

---

### 2. `GridManager.h`
*   **çˆ¶ç±»é€‰æ‹©**ï¼š**Actor**
*   **ç±»åå¡«å†™**ï¼š`GridManager`
    *   *æ³¨ï¼šUE ä¼šè‡ªåŠ¨åŠ å‰ç¼€å˜æˆ `AGridManager`ï¼Œä½ åªå¡«åå­—ã€‚*

---

### 3. `BaseGameEntity.h`
*   **çˆ¶ç±»é€‰æ‹©**ï¼š**Pawn**
    *   *æ³¨ï¼šä»£ç é‡Œæ˜¯ `public APawn`ï¼Œæ‰€ä»¥é€‰ Pawnã€‚*
*   **ç±»åå¡«å†™**ï¼š`BaseGameEntity`

---

### 4. `BaseUnit.h` (æ³¨æ„ï¼)
è¿™é‡Œæœ‰ä¸ªç»§æ‰¿å…³ç³»ï¼š`BaseUnit` ç»§æ‰¿è‡ª `BaseGameEntity`ã€‚

*   **æ¨èåšæ³•**ï¼š**çˆ¶ç±»é€‰æ‹© Pawn**
    *   è™½ç„¶å®ƒçš„é€»è¾‘çˆ¶ç±»æ˜¯ `BaseGameEntity`ï¼Œä½†ä¸ºäº†é¿å…ä½ åœ¨å‘å¯¼é‡Œæœä¸åˆ°åˆšå»ºçš„ç±»ï¼ˆå› ä¸ºè¿˜æ²¡ç¼–è¯‘ï¼‰ï¼Œç›´æ¥é€‰ **Pawn** æœ€ç¨³å¦¥ã€‚
*   **ç±»åå¡«å†™**ï¼š`BaseUnit`
*   **åç»­æ“ä½œ**ï¼šå½“ä½ æŠŠä»£ç ç²˜è´´è¿›å»åï¼Œä»£ç é‡Œçš„ `public ABaseGameEntity` ä¼šè‡ªåŠ¨è¦†ç›–æ‰é»˜è®¤çš„ `public APawn`ï¼Œè¿™æ ·ç»§æ‰¿å…³ç³»å°±æ¥ä¸Šäº†ã€‚

---

### 5. `RTSGameInstance.h`
*   **çˆ¶ç±»é€‰æ‹©**ï¼š**GameInstance**
    *   *æ³¨ï¼šå¯èƒ½éœ€è¦ç‚¹å‡» "Show All Classes" æ‰èƒ½æœåˆ°ã€‚*
*   **ç±»åå¡«å†™**ï¼š`RTSGameInstance`

---

### 6. `RTSGameMode.h`
*   **çˆ¶ç±»é€‰æ‹©**ï¼š**GameModeBase**
*   **ç±»åå¡«å†™**ï¼š`RTSGameMode`

---

### 7. `RTSPlayerController.h`
*   **çˆ¶ç±»é€‰æ‹©**ï¼š**PlayerController**
*   **ç±»åå¡«å†™**ï¼š`RTSPlayerController`

---

### âš ï¸ åˆ›å»ºé¡ºåºå»ºè®®

ä¸ºäº†å‡å°‘ç¼–è¯‘æŠ¥é”™ï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºåˆ›å»ºï¼ˆå…ˆçˆ¶ç±»ï¼Œåå­ç±»ï¼Œå…ˆè¢«å¼•ç”¨çš„ï¼Œåå¼•ç”¨çš„ï¼‰ï¼š

1.  **RTSCoreTypes** (æœ€åº•å±‚ï¼Œå¤§å®¶éƒ½ç”¨å®ƒ)
2.  **GridManager** (è¢«åˆ«äººå¼•ç”¨)
3.  **BaseGameEntity** (çˆ¶ç±»)
4.  **BaseUnit** (å­ç±»)
5.  **RTSGameInstance**
6.  **RTSPlayerController**
7.  **RTSGameMode** (å¼•ç”¨äº†ä¸Šé¢æ‰€æœ‰äºº)

æ¯åˆ›å»ºä¸€ä¸ªï¼Œå»ºè®®æŒ‰ä¸€ä¸‹ç¼–è¯‘ï¼ˆæˆ–è€…å…¨éƒ¨åˆ›å»ºå®Œäº†ä¸€èµ·åœ¨ VS é‡Œç¼–è¯‘ï¼‰ã€‚æŠŠä»£ç ç²˜è´´è¿›å»è¦†ç›–å³å¯ã€‚åŠ æ²¹ï¼

è¿™ä»½æ¸…å•æ˜¯æ ¹æ®æˆ‘ä»¬åˆšåˆšç¡®å®šçš„**â€œæ‰‹å†™å¯»è·¯ + çº¯C++é€»è¾‘â€**æ¶æ„æ•´ç†çš„ã€‚

ä½ å¯ä»¥æŠŠè¿™ä»½è¡¨å‘åˆ°ç¾¤é‡Œï¼Œè®©å¤§å®¶å¯¹ç…§æ£€æŸ¥ã€‚å¦‚æœæŸä¸ªæ ¼å­çš„å‹¾æ²¡æ‰“ä¸Šï¼Œä»£ç è·‘èµ·æ¥ä¸€å®šä¼šå´©æˆ–è€…æ²¡ååº”ã€‚

---

### ğŸ›ï¸ ç¬¬ 0 éƒ¨åˆ†ï¼šåŸºç¡€è®¾æ–½ (å…¨ä½“å¿…é¡»å…ˆæœ‰è¿™ä¸ª)
**æ–‡ä»¶ï¼š** `RTSCoreTypes.h`
**çŠ¶æ€ï¼š** ğŸŸ¥ **æœ€ä¼˜å…ˆ** (æ²¡æœ‰è¿™ä¸ªï¼Œåé¢å…¨æ˜¯ç¼–è¯‘é”™è¯¯)

| ç±»/æ–‡ä»¶ | ä»»åŠ¡é¡¹ | è¯´æ˜ | è´Ÿè´£äºº |
| :--- | :--- | :--- | :--- |
| **RTSCoreTypes.h** | å®šä¹‰ `UENUM` **ETeam** | åŒºåˆ† `Player` (ç©å®¶) å’Œ `Enemy` (æ•Œäºº) | **ä»»æ„ä¸€äºº** |
| **RTSCoreTypes.h** | å®šä¹‰ `UENUM` **EUnitType** | åŒºåˆ† `Soldier`, `Archer` ç­‰ï¼Œç”¨äºå•†åº—è´­ä¹° | **ä»»æ„ä¸€äºº** |
| **RTSCoreTypes.h** | å®šä¹‰ `UENUM` **EGameState** | `Preparation` (å¤‡æˆ˜), `Battle` (å¼€æ‰“), `Victory` | **ä»»æ„ä¸€äºº** |
| **RTSCoreTypes.h** | å®šä¹‰ `UENUM` **EUnitState** | `Idle`, `Moving`, `Attacking` | **ä»»æ„ä¸€äºº** |

---

### ğŸ—ºï¸ ç¬¬ 1 éƒ¨åˆ†ï¼šæˆå‘˜ A (ç½‘æ ¼ä¸ç®—æ³•)
**æ ¸å¿ƒç›®æ ‡ï¼š** æä¾›â€œåœ°å›¾å¯¼èˆªæœåŠ¡â€ã€‚

| ç±»/æ–‡ä»¶ | å‡½æ•°/å˜é‡ | è¯¦ç»†é€»è¾‘ (æŸ¥æ¼) | çŠ¶æ€ |
| :--- | :--- | :--- | :--- |
| **FGridNode** (ç»“æ„ä½“) | `bool bIsBlocked` | æ•°æ®ç»“æ„å®šä¹‰å¥½ï¼ŒåŒ…å« X, Y, WorldPos, bIsBlocked | â¬œ |
| **AGridManager** | `GenerateGrid()` | **[å…³é”®]** æ ¹æ®å®½é«˜ç”ŸæˆäºŒç»´æ•°ç»„ï¼Œå¹¶ç”»å‡º Debug Line (æ ¼å­çº¿) æ–¹ä¾¿è°ƒè¯• | â¬œ |
| **AGridManager** | `WorldToGrid()` | æ•°å­¦è®¡ç®—ï¼šæŠŠé¼ æ ‡ç‚¹çš„ä¸–ç•Œåæ ‡è½¬æ¢æˆ Grid[x][y] | â¬œ |
| **AGridManager** | `GridToWorld()` | æ•°å­¦è®¡ç®—ï¼šæŠŠ Grid[x][y] è½¬å›ä¸–ç•Œåæ ‡ä¸­å¿ƒç‚¹ (ç»™å…µç§å¯»è·¯ç”¨) | â¬œ |
| **AGridManager** | `IsTileWalkable()` | æ£€æŸ¥æ•°ç»„è¶Šç•Œ + æ£€æŸ¥ `bIsBlocked` | â¬œ |
| **AGridManager** | `SetTileBlocked()` | å°†æŒ‡å®šæ ¼å­çš„ `bIsBlocked` è®¾ä¸º true (C æ”¾å¡”æ—¶è°ƒç”¨) | â¬œ |
| **AGridManager** | `FindPath()` | **[æ ¸å¿ƒéš¾ç‚¹]** è¾“å…¥èµ·ç‚¹ç»ˆç‚¹ï¼Œè¿”å› `TArray<FVector>`ã€‚å®ç° BFS æˆ– A* | â¬œ |

---

### âš”ï¸ ç¬¬ 2 éƒ¨åˆ†ï¼šæˆå‘˜ B (å•ä½ä¸ç§»åŠ¨)
**æ ¸å¿ƒç›®æ ‡ï¼š** è®©æ–¹å—åŠ¨èµ·æ¥ï¼Œä¸”èƒ½æ‰“æ¶ã€‚

| ç±»/æ–‡ä»¶ | å‡½æ•°/å˜é‡ | è¯¦ç»†é€»è¾‘ (æŸ¥æ¼) | çŠ¶æ€ |
| :--- | :--- | :--- | :--- |
| **ABaseGameEntity** | `TakeDamage()` | æ‰£å‡ `CurrentHealth`ï¼Œå¦‚æœ <=0 è°ƒç”¨ `Die()` | â¬œ |
| **ABaseGameEntity** | `Die()` | é”€æ¯ Actorï¼Œå¹¶é€šçŸ¥ GameMode (æ£€æŸ¥èƒœè´Ÿ) | â¬œ |
| **ABaseUnit** | `Tick()` | **[å…³é”®]** çŠ¶æ€æœºå…¥å£ï¼šæ£€æŸ¥å½“å‰æ˜¯ Idle è¿˜æ˜¯ Moving è¿˜æ˜¯ Attacking | â¬œ |
| **ABaseUnit** | `RequestPathToTarget()` | è°ƒç”¨ A çš„ `GridManager->FindPath`ï¼ŒæŠŠç»“æœå­˜å…¥ `PathPoints` | â¬œ |
| **ABaseUnit** | `MoveAlongPath()` | **[æ ¸å¿ƒéš¾ç‚¹]** æ‰‹å†™ç§»åŠ¨ï¼šæ¯å¸§å‘ `PathPoints[index]` ç§»åŠ¨ï¼Œåˆ°äº†å°±æ¢ä¸‹ä¸€ä¸ªç‚¹ | â¬œ |
| **ABaseUnit** | `FindClosestEnemy()` | éå†åœºæ™¯æ‰€æœ‰ Entityï¼Œç®—å‡ºæœ€è¿‘çš„ä¸€ä¸ªè®¾ä¸º `CurrentTarget` | â¬œ |
| **ABaseUnit** | `PerformAttack()` | è®¡æ—¶å™¨å†·å´åˆ¤å®š -> å¯¹ Target è°ƒç”¨ TakeDamage | â¬œ |
| **Blueprints** | `BP_Soldier` | ç»§æ‰¿è‡ª C++ï¼Œè®¾ç½®å¥½ Mesh (çƒ/æ–¹å—)ï¼Œè®¾å¥½æ”»å‡»åŠ›ã€è¡€é‡ | â¬œ |

---

### ğŸ—ï¸ ç¬¬ 3 éƒ¨åˆ†ï¼šæˆå‘˜ C (æµç¨‹ä¸äº¤äº’)
**æ ¸å¿ƒç›®æ ‡ï¼š** ä¹Ÿæ˜¯æœ€æ‚çš„éƒ¨åˆ†ï¼Œè´Ÿè´£æŠŠ A å’Œ B ä¸²èµ·æ¥ã€‚

| ç±»/æ–‡ä»¶ | å‡½æ•°/å˜é‡ | è¯¦ç»†é€»è¾‘ (æŸ¥æ¼) | çŠ¶æ€ |
| :--- | :--- | :--- | :--- |
| **RTSGameInstance** | `PlayerGold` | å®šä¹‰å˜é‡ï¼Œç¡®ä¿è·¨å…³å¡é‡‘å¸ä¸ä¸¢å¤± | â¬œ |
| **RTSGameMode** | `BeginPlay()` | åˆå§‹åŒ–æµç¨‹ï¼Œç”Ÿæˆ A çš„ `GridManager` (æˆ–è€…ä»åœºæ™¯è·å–) | â¬œ |
| **RTSGameMode** | `TryBuyUnit()` | æ£€æŸ¥é‡‘å¸ -> æ‰£é’± -> è¿”å› true/false | â¬œ |
| **RTSGameMode** | `StartBattlePhase()` | åˆ‡æ¢çŠ¶æ€åˆ° `Battle`ï¼Œé€šçŸ¥æ‰€æœ‰ Unit æ¿€æ´» AI (è°ƒç”¨ B çš„ SetUnitActive) | â¬œ |
| **RTSGameMode** | `CheckWinCondition()` | æ¯æ¬¡æœ‰å•ä½æ­»äº¡æ—¶æ£€æŸ¥ï¼šæ•Œäººå¤§æœ¬è¥æ²¡äº†å—ï¼Ÿæˆ–è€…æˆ‘æ–¹æ­»å…‰äº†ï¼Ÿ | â¬œ |
| **RTSPlayerController** | `HandleLeftClick()` | å°„çº¿æ£€æµ‹ -> è°ƒ A çš„ `WorldToGrid` -> è°ƒ GameMode æ‰£é’± -> ç”Ÿæˆ Actor -> è°ƒ A çš„ `SetBlocked` | â¬œ |
| **UI** | `WBP_HUD` | æŒ‰é’®ï¼šè´­ä¹°å£«å…µ (ç»‘å®š Controller)ï¼›æŒ‰é’®ï¼šå¼€å§‹æˆ˜æ–— (ç»‘å®š GameMode) | â¬œ |
| **Map** | `Map_Main` | æ”¾ç½®åœ°æ¿ã€å…‰ç…§ã€PlayerStartã€ä»¥åŠ**æ•Œäººçš„åŸºåœ°å’Œé˜²å¾¡å¡”** | â¬œ |

---

### âš ï¸ å¿…é¡»æ£€æŸ¥çš„â€œè¿æ¥ç‚¹â€ (Integration Check)

è¿™å‡ ä¸ªç‚¹æœ€å®¹æ˜“å‡º Bugï¼Œå†™å®Œåè¯·é‡ç‚¹æµ‹è¯•ï¼š

1.  **A ä¸ C çš„è¿æ¥**ï¼š
    *   [ ] C ç‚¹å‡»é¼ æ ‡é€ å¡”åï¼ŒA çš„ `GridNodes` æ•°æ®çœŸçš„å˜äº†å—ï¼Ÿ(ç”¨ `print` æ‰“å°ä¸€ä¸‹è¯¥æ ¼å­çš„çŠ¶æ€)
    *   *åæœï¼šå¦‚æœæ²¡å˜ï¼Œå…µä¼šç›´æ¥ç©¿è¿‡é˜²å¾¡å¡”ã€‚*

2.  **A ä¸ B çš„è¿æ¥**ï¼š
    *   [ ] B çš„å…µç”Ÿæˆåï¼Œè°ƒç”¨ A çš„ `FindPath`ï¼ŒçœŸçš„è¿”å›äº†éç©ºçš„è·¯å¾„æ•°ç»„å—ï¼Ÿ
    *   *åæœï¼šå¦‚æœè¿”å›ç©ºï¼Œå…µä¼šåŸåœ°å‘å‘†ã€‚*

3.  **B ä¸ C çš„è¿æ¥**ï¼š
    *   [ ] å…µè¢«æ‰“æ­» (`Die`) åï¼ŒC çš„ `CheckWinCondition` çœŸçš„è¢«è°ƒç”¨äº†å—ï¼Ÿ
    *   *åæœï¼šæ¸¸æˆæ°¸è¿œä¸ä¼šç»“æŸã€‚*

4.  **C çš„é€ å…µé€»è¾‘**ï¼š
    *   [ ] é€ å…µæ—¶ï¼Œæœ‰æ²¡æœ‰æŠŠå…µçš„ä¸–ç•Œåæ ‡å¯¹é½åˆ°æ ¼å­ä¸­å¿ƒï¼Ÿ(è°ƒç”¨ A çš„ `GridToWorld`)
    *   *åæœï¼šå…µä¼šå¡åœ¨ä¸¤ä¸ªæ ¼å­ä¸­é—´ï¼Œå¯¼è‡´å¯»è·¯è®¡ç®—èµ·å§‹ç‚¹é”™è¯¯ã€‚*